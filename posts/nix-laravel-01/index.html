<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://sirimhrzn.github.io//favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://sirimhrzn.github.io//favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sirimhrzn.github.io//favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://sirimhrzn.github.io//android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://sirimhrzn.github.io//apple-touch-icon.png><meta name=description content><title>Part 0: Integrating Nix for CI, Package Management ft. Laravel | Siri
</title><link rel=canonical href=https://sirimhrzn.github.io/posts/nix-laravel-01/><meta property="og:url" content="https://sirimhrzn.github.io/posts/nix-laravel-01/"><meta property="og:site_name" content="Siri"><meta property="og:title" content="Part 0: Integrating Nix for CI, Package Management ft. Laravel"><meta property="og:description" content="I would like to keep things short and simple so if you do not know about nix i will be listing couple resources to follow and these are the things I will be achieving by the end of this series.
Package Laravel using nix Build container image with nix Setup gitlab-runner and run CI with nix Setup a binary cache server Simple Integration Test using testers.runNixOSTest Why nix? I want my production to be running the same runtime dependencies I used during development."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-01T19:11:12+05:45"><meta property="article:modified_time" content="2024-11-01T19:11:12+05:45"><meta property="article:tag" content="Nix"><meta property="article:tag" content="Php"><meta property="article:tag" content="Laravel"><link rel=stylesheet href=/assets/combined.min.14e1218b5e9a0404dee05846c1ffd60757d618f79d3897fdd4eea5f441a9a7af.css media=all></head><body class=auto><div class=content><header><div class=header><h1 class=header-title><a href=https://sirimhrzn.github.io/>Siri</a></h1><div class=flex><p class=small><a href=/>/home</a></p><p class=small><a href=/posts>/posts</a></p></div></div></header><main class=main><div><div class=single-intro-container><h1 class=single-title>Part 0: Integrating Nix for CI, Package Management ft. Laravel</h1><p class=single-readtime><time datetime=2024-11-01T19:11:12+05:45>November 1, 2024</time></p></div><div class=single-content><p>I would like to keep things short and simple so if you do not know about nix i will be listing couple resources to follow and these are the things I will be achieving by the end of this series.</p><ul><li>Package Laravel using nix</li><li>Build container image with nix</li><li>Setup gitlab-runner and run CI with nix</li><li>Setup a binary cache server</li><li>Simple Integration Test using <code>testers.runNixOSTest</code></li></ul><h2 id=why-nix>Why nix?</h2><blockquote><p>I want my production to be running the same runtime dependencies I used during development.</p></blockquote><p>I&rsquo;m introducing nix in the packaging process because I already use nix for my development environment and everything works completely fine. But, we run completely different tools on production i.e not nix. We rely on docker images and don&rsquo;t get me wrong for the most part they work completely fine but the process of installing managing extensions feels painful, things like <code>docker-php-ext-install</code> exist which are very docker specific and is completely different from the development environment. There was this case where I had finished development using php-extensions such as <code>openswoole</code> <code>redis</code> etc but I was unable to get a docker image running with those extensions and even if i did caching was problem, then I decided I&rsquo;m going to use the same tools on production that I used during my development.</p><h3 id=things-i-used-throughout-this-series>Things i used throughout this series</h3><ul><li><a href=https://github.com/svanderburg/composer2nix>Composer2nix</a> (Generating Nix expressions for Composer Packages)</li><li><a href=https://github.com/containers/skopeo>Skopeo</a> (Maintaining Image Registry)</li><li><a href=https://docs.gitlab.com/runner/>Gitlab Runner</a> (CI/CD)</li><li><a href=https://docs.attic.rs/introduction.html>Attic</a> (Binary Cache Server)</li></ul><h3 id=acknowledgement>Acknowledgement</h3><p>I specially would like to thank these blog posts as they helped me a lot during my learning and research related to everything nix.</p><ul><li><a href=https://www.haskellforall.com/2022/10/how-to-correctly-cache-build-time.html>How to correctly cache build-time dependencies using Nix</a></li><li><a href=https://www.haskellforall.com/2020/11/how-to-use-nixos-for-lightweight.html>How to use NixOS for lightweight integration tests</a></li></ul></div><div class=single-pagination><hr><div class=flex><div class=single-pagination-prev></div><div class=single-pagination-next><div class=single-pagination-container-next><div class=single-pagination-text><a href=/posts/nix-laravel-02/>Part 1: Using Nix to package Laravel/Lumen</a></div><div class=single-pagination-text>â†’</div></div></div></div><hr></div><div class=back-to-top><a href=#top>back to top</a></div></div></main></div><footer><p>Powered by
<a href=https://gohugo.io/>Hugo</a>
and
<a href=https://github.com/tomfran/typo>tomfran/typo</a></p></footer></body><script>function isAuto(){return document.body.classList.contains("auto")}function setTheme(){if(!isAuto())return;document.body.classList.remove("auto");let e="light";window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(e="dark"),document.body.classList.add(e)}function invertBody(){document.body.classList.toggle("dark"),document.body.classList.toggle("light")}isAuto()&&window.matchMedia("(prefers-color-scheme: dark)").addListener(invertBody),setTheme()</script></html>